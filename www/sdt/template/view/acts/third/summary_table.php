<?php/** @var Act $act */$director_head = $signer->position . ' ' . $signer->caption;$director_local = $local_signer;$official = trim($act->official);$official = str_replace('  ', ' ', $official);$official_array = explode(' ', $official);$official_first = array_shift($official_array);$official_second = implode(' ', $official_array);$act_number = $act->number;$dogovor_date_simple = date('d.m.Y', strtotime($act->getUniversityDogovor()->date));$dogovor_date = date_of($dogovor_date_simple);$testing_date = date_of(date('d.m.Y', strtotime($act->testing_date)));if (!$act->check_date || $act->check_date == '0000-00-00') {    $document_check_date = date_of(date('d.m.Y'));    $document_check_date2 = date_of(date('d.m.Y'), 1);} //документы провереныelse {    $document_check_date = date_of(date('d.m.Y', strtotime($act->check_date)));    $document_check_date2 = date_of(date('d.m.Y', strtotime($act->check_date)), 1);}function date_of($date, $no_quotes = 0){    $date_day = substr($date, 0, 2);    $date_month = substr($date, 3, 2);    $date_year = substr($date, 6, 4);    $date_month = str_replace('01', 'Января', $date_month);    $date_month = str_replace('02', 'Февраля', $date_month);    $date_month = str_replace('03', 'Марта', $date_month);    $date_month = str_replace('04', 'Апреля', $date_month);    $date_month = str_replace('05', 'Мая', $date_month);    $date_month = str_replace('06', 'Июня', $date_month);    $date_month = str_replace('07', 'Июля', $date_month);    $date_month = str_replace('08', 'Августа', $date_month);    $date_month = str_replace('09', 'Сентября', $date_month);    $date_month = str_replace('10', 'Октября', $date_month);    $date_month = str_replace('11', 'Ноября', $date_month);    $date_month = str_replace('12', 'Декабря', $date_month);    if ($no_quotes)        $date = $date_day . ' ' . $date_month . ' ' . $date_year;    else        $date = '&laquo;' . $date_day . '&raquo; ' . $date_month . ' ' . $date_year;    return $date;}//$vuz_name = $act->getUniversity()->name; // было до 22.12.16//if (empty($act->getUniversity()->print_invoice_quoute))if (empty($act->getUniversity()->getParentedFieldValue('print_invoice_quoute'))) {    $vuz_name = $act->getUniversity()->getLegalInfo()['form'] . ' ' . $act->getUniversity()->getLegalInfo()['name_parent'];} else {    $vuz_name = $act->getUniversity()->getLegalInfo()['form'] . ' &laquo;' . $act->getUniversity()->getLegalInfo()['name_parent'] . '&raquo;';}$dogovor_num = $act->getUniversityDogovor()->number;$sum_total = sprintf('%01.2f', $act->amount_contributions);if (\SDT\logic\Prices\Nds::isNeedNDS($act)) {    $nds = new \SDT\logic\Prices\Nds($act->actDate());    $nds_header_text = ', в т.ч. НДС ' . $nds->getNdsValue() . '%';    $nds_text = ', в том числе НДС ' . $nds->getNdsValue() . '% - ' . $nds->getNdsPart($sum_total);} else $nds_header_text = $nds_text = '';$nds = new \SDT\logic\Prices\Nds($act->actDate());$sum_total2 = $nds->getNdsPart($sum_total);$sum_total2 = sprintf('%01.2f', $sum_total2);$per = $sum_total; //не трогать, это для вывода суммы$per2 = $sum_total2; //не трогать, это для вывода суммы$otvetst = $act->responsible; //ответственный за проведение тестирования$sum_total_rub = substr($sum_total, 0, (strpos($sum_total, '.')));$sum_total_kop = substr($sum_total, (strpos($sum_total, '.') + 1));$sum_total_rub2 = substr($sum_total2, 0, (strpos($sum_total2, '.')));$sum_total_kop2 = substr($sum_total2, (strpos($sum_total2, '.') + 1));?><html><script>window.print();</script><!----><head>    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">    <style>        .main_td td {            padding: 0 2pt 0 2pt !important;        }        .act_test {            font-size: 10pt;        }        .act_test_head {            font-size: 10pt;            /*padding: 0.05cm 5.4pt 0.05cm 5.4pt;*/            padding: 0.05cm 0;        }    </style></head><body><div style="width:180mm">    <?php    //Перевод денежных единиц в пропись    function num2str($num)    {        $nul = 'ноль';        $ten = array(            array('', 'один', 'два', 'три', 'четыре', 'пять', 'шесть', 'семь', 'восемь', 'девять'),            array('', 'одна', 'две', 'три', 'четыре', 'пять', 'шесть', 'семь', 'восемь', 'девять'),        );        $a20 = array('десять', 'одиннадцать', 'двенадцать', 'тринадцать', 'четырнадцать', 'пятнадцать', 'шестнадцать', 'семнадцать', 'восемнадцать', 'девятнадцать');        $tens = array(2 => 'двадцать', 'тридцать', 'сорок', 'пятьдесят', 'шестьдесят', 'семьдесят', 'восемьдесят', 'девяносто');        $hundred = array('', 'сто', 'двести', 'триста', 'четыреста', 'пятьсот', 'шестьсот', 'семьсот', 'восемьсот', 'девятьсот');        $unit = array( // Units            array('копейка', 'копейки', 'копеек', 1),            array('рубль', 'рубля', 'рублей', 0),            array('тысяча', 'тысячи', 'тысяч', 1),            array('миллион', 'миллиона', 'миллионов', 0),            array('миллиард', 'милиарда', 'миллиардов', 0),        );        //        list($rub, $kop) = explode('.', sprintf("%015.2f", floatval($num)));        $out = array();        if (intval($rub) > 0) {            foreach (str_split($rub, 3) as $uk => $v) { // by 3 symbols                if (!intval($v)) continue;                $uk = sizeof($unit) - $uk - 1; // unit key                $gender = $unit[$uk][3];                list($i1, $i2, $i3) = array_map('intval', str_split($v, 1));                // mega-logic                $out[] = $hundred[$i1]; # 1xx-9xx                if ($i2 > 1) $out[] = $tens[$i2] . ' ' . $ten[$gender][$i3]; # 20-99                else $out[] = $i2 > 0 ? $a20[$i3] : $ten[$gender][$i3]; # 10-19 | 1-9                // units without rub & kop                if ($uk > 1) $out[] = morph($v, $unit[$uk][0], $unit[$uk][1], $unit[$uk][2]);            } //foreach        } else $out[] = $nul;        $out[] = morph(intval($rub), $unit[1][0], $unit[1][1], $unit[1][2]); // rub        $out[] = $kop . ' ' . morph($kop, $unit[0][0], $unit[0][1], $unit[0][2]); // kop        return trim(preg_replace('/ {2,}/', ' ', join(' ', $out)));    }    //Склоняем словоформу    function morph($n, $f1, $f2, $f5)    {        $n = abs(intval($n)) % 100;        if ($n > 10 && $n < 20) return $f5;        $n = $n % 10;        if ($n > 1 && $n < 5) return $f2;        if ($n == 1) return $f1;        return $f5;    }    $asd = '-';    $dsa = '.';    $per = str_replace('-', '.', $per);    $per = str_replace(',', '.', $per);    $per = str_replace(' ', '.', $per);    $per = num2str($per);    $per2 = str_replace('-', '.', $per2);    $per2 = str_replace(',', '.', $per2);    $per2 = str_replace(' ', '.', $per2);    $per2 = num2str($per2); //Пропись на вывод    $per_1 = strtoupper(substr($per, 0, 1));    $per_2 = substr($per, 1);    $per = $per_1 . $per_2;    $per2_1 = strtoupper(substr($per2, 0, 1));    $per2_2 = substr($per2, 1);    $per2 = $per2_1 . $per2_2;    //Конец перевода денежных единиц    ?>    <!--<p align=right><u><i><b>Бланк 4</b></i></u></p>-->    <div style="width:180mm">        <div align=center><span style="font-size:15.0pt;color:#333333">                 <? if ($act->test_level_type_id == 1): ?>                     <b>Сводный протокол тестовой сессии по русскому языку как иностранному</b>                 <? else: ?>                     <b>Сводный протокол экзаменационной сессии по русскому языку,<br>истории России и основам законодательства Российской Федерации</b>                 <? endif; ?>                <br>                № <u><?= (!empty($act->getUniversity()->is_head)) ? HC_PREFIX_GC : HC_PREFIX; ?>/<?= $act->id; ?></u></span></div>        <br>        <? /*= $vuz_name; */ ?><!--</u><br>(далее по тексту «Организация») к Договору № <u><? /*= $dogovor_num; */ ?></u>от    <u><? /*= strtolower($dogovor_date); */ ?>г.</u><br>(далее по тексту «Договор) о нижеследующем:</span></div>-->        <div align="center" style="text-align: justify"><span                    style="font-size:12.0pt;color:#333333;">            &nbsp;&nbsp;&nbsp;&nbsp;Настоящий сводный протокол              <? if ($act->test_level_type_id == 1): ?>                  тестовой сессии по русскому языку как иностранному              <? else: ?>                  экзаменационной сессии по русскому языку, истории России и основам законодательства Российской Федерации              <? endif; ?>            составлен            <?= $act->getUniversity()->getLegalInfo()['form'] . ' ' . $act->getUniversity()->getLegalInfo()['name_parent']; ?>            (далее – по тексту – «Организация») в лице <?= $director_local; ?>            в электронном виде и согласован            <?= TEXT_HEADCENTER_LONG_TP_PRINT_ACT_NEW ?> (далее по тексту «<?= TEXT_HEADCENTER_SHORT_IP ?>»)            в лице <?= $director_head; ?> в электронном виде в соответствии с            Договором <br>№ <u><?= $dogovor_num; ?></u> от <u><?= strtolower($dogovor_date); ?>г.</u> (далее по тексту «Договор) о нижеследующем:                <!--  Настоящий акт составлен между <? /*= TEXT_HEADCENTER_LONG_TP_PRINT_ACT_NEW */ ?>            (далее по тексту «<? /*= TEXT_HEADCENTER_SHORT_IP */ ?>»)и<br><u><? /*= $vuz_name; */ ?></u><br>(далее по тексту «Организация») к Договору № <u><? /*= $dogovor_num; */ ?></u> от    <u><? /*= strtolower($dogovor_date); */ ?>г.</u><br>(далее по тексту «Договор) о нижеследующем:<b></b>--></span>        </div>        <div align="center" style="text-align:center"><b>&nbsp;</b></div>        <?        $show_free = Reexam_config::isShowInAct($act->test_level_type_id); //отображать ли "из них бесплатно"        if ($act->test_level_type_id == 1) {            if ($act->isBaseForForeign())                $act_table_type = 'act_table_type_migrant.php';            else                $act_table_type = 'act_table_type_1.php';            $test_session_name = 'тестовая';            $session_type = 'тестовой ';            $responsible_for = 'тестирования';        } else {            $act_table_type = 'act_table_type_2.php';            $test_session_name = 'экзаменационная';            $session_type = 'экзаменационной ';            $responsible_for = 'экзамена';        }        ?>        <div style="margin-left:18.0pt;text-align:justify;text-indent:-18.0pt;"><span style="font-size:12.0pt;color:#333333"><b>1.</b><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span                    style="font-size:12.0pt;color:#333333">В соответствии с Договором <u><?= strtolower($testing_date); ?>                г.</u> проведена              <? if ($act->test_level_type_id == 1): ?>                  тестовая сессия              <? else: ?>                  экзаменационная сессия              <? endif ?>            в локальном центре тестирования <?= $act->getUniversity()->getLegalInfo()['name']; ?>:        </div>        <?        require($act_table_type);        ?>        <div style="text-align:justify"><i>&nbsp;</i></div>        <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333;">		Все документы по проведению указанной <?= $session_type; ?>сессии подлежат передаче в <?= TEXT_HEADCENTER_SHORT_IP ?> в соответствии с Инструкцией.	<br>	Результаты сессии проверены <?= strtolower($document_check_date); ?>г.    <br>	<b>2.</b> Стоимость услуг <?= TEXT_HEADCENTER_SHORT_IP ?> при проведении вышеуказанной <?= $session_type; ?>сессии составляет	<nobr><b><u><?= $sum_total_rub; ?></u>  <i>руб.</i> <u><?= $sum_total_kop; ?></u> <i>коп.</i> </b></nobr>	(<u><?= $per; ?></u>)<?= $nds_text ?> и подлежит перечислению в <?= TEXT_HEADCENTER_SHORT_IP ?> в соответствии с Договором.		</span>        </div>        <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333">	<b>3.</b> Претензии со стороны Организации по исполнению <?= TEXT_HEADCENTER_SHORT_IP ?> своих обязательств в рамках Договора отсутствуют.		</span></div>        <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333"><b>4.</b> Настоящий протокол составил и достоверность данных подтвердил <?= $director_local; ?>.</span></div>        <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333"><b>5.</b> Настоящий протокол согласован – <?= $director_head; ?>.</span></div>        <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;</span></div>        <!--<div style="text-align:justify">&nbsp;</div>-->    </div></body></html>