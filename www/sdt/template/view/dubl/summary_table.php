<?php/** @var DublAct $act */$director_head = $signer->position . ' ' . $signer->caption;$director_local = $local_signer;$University=University::getByID($act->center_id);$University_dogovor=University_dogovor::getByID($act->center_dogovor_id);$official=trim($act->official);$official=str_replace('  ',' ',$official);$official_array=explode(' ',$official);$official_first=array_shift($official_array);$official_second=implode(' ',$official_array);//$act_number =$act->number;//!!!!!!!!!!!//$act_number =0;//!!!!!!!!!!!$dogovor_date_simple = date('d.m.Y',strtotime($University_dogovor->date));$dogovor_date = date_of($dogovor_date_simple);$invoice_date_simple = date('d.m.Y',strtotime($act->invoice_date));$invoice_date = date_of ($invoice_date_simple);/*$testing_date =date_of(date('d.m.Y',strtotime($act->testing_date)));if(!$act->check_date || $act->check_date=='0000-00-00'){    $document_check_date=date_of(date('d.m.Y'));} //документы провереныelse{    $document_check_date=date_of(date('d.m.Y',strtotime($act->check_date)));}*/function date_of($date, $no_quotes=0) {    $date_day=substr($date, 0, 2);    $date_month=substr($date, 3, 2);    $date_year=substr($date, 6, 4);    $date_month = str_replace('01', 'Января', $date_month);    $date_month = str_replace('02', 'Февраля', $date_month);    $date_month = str_replace('03', 'Марта', $date_month);    $date_month = str_replace('04', 'Апреля', $date_month);    $date_month = str_replace('05', 'Мая', $date_month);    $date_month = str_replace('06', 'Июня', $date_month);    $date_month = str_replace('07', 'Июля', $date_month);    $date_month = str_replace('08', 'Августа', $date_month);    $date_month = str_replace('09', 'Сентября', $date_month);    $date_month = str_replace('10', 'Октября', $date_month);    $date_month = str_replace('11', 'Ноября', $date_month);    $date_month = str_replace('12', 'Декабря', $date_month);    if ($no_quotes)        $date = $date_day . ' ' . $date_month . ' '. $date_year ;    else        $date = '&laquo;' . $date_day . '&raquo; ' . $date_month . ' '. $date_year ;    return $date;}//$vuz_name = $University->name;$vuz_name = $University->getLegalInfo()['name_parent'];$dogovor_num = $University_dogovor->number;$kolichestvo = count(DublActManList::getByDublAct($act->id));$dubl_price = $act->invoice_price;//$per = $Act->amount_contributions;$per = $kolichestvo*$dubl_price;//$nds_total= $per - $per/1.20;//$nds_total = str_replace('.', ',', sprintf("%01.2f", ($per - $per / 1.20)));$nds=new \SDT\logic\Prices\Nds($act->accepted_date);$nds_total = $nds->getNdsPart($per);//$nds_total = sprintf("%01.2f", ($per - $per / 1.20));$sum_total = sprintf('%01.2f',$per);//$sum_total2= $sum_total - $sum_total/1.20;//$sum_total2 = sprintf('%01.2f',$sum_total2);$per = $sum_total; //не трогать, это для вывода суммы//$per2 = $sum_total2; //не трогать, это для вывода суммы//$otvetst = $act->responsible; //ответственный за проведение тестирования$sum_total_rub = substr($sum_total, 0, (strpos($sum_total, '.')));$sum_total_kop = substr($sum_total, (strpos($sum_total, '.') + 1));$nds_total_rub = substr($nds_total, 0, (strpos($nds_total, '.')));$nds_total_kop = substr($nds_total, (strpos($nds_total, '.') + 1));//$sum_total_rub2 = substr($sum_total2, 0, (strpos($sum_total2, '.')));//$sum_total_kop2 = substr($sum_total2, (strpos($sum_total2, '.') + 1));?><html><script>window.print();</script><!----><head>    <meta http-equiv="Content-Type" content="text/html; charset=windows-1251">    <style>        .main_td td        {            pad ding: 0 2pt 0 2pt !important;            wid th:17.78%;            border:solid windowtext 1.0pt;            padding:0cm 5.4pt 0cm 5.4pt;            text-align:center;        }        .act_test        {            font-size: 10pt;        }        .act_test_head        {            font-size: 10pt;            padding:0.05cm 5.4pt 0.05cm 5.4pt;        }    </style></head><body><div style="width:180mm">    <?php    # Число прописью    function num_propis($num){ // $num - цело число# Все варианты написания чисел прописью от 0 до 999 скомпануем в один небольшой массив        $m=array(            array('ноль'),            array('-','один','два','три','четыре','пять','шесть','семь','восемь','девять'),            array('десять','одиннадцать','двенадцать','тринадцать','четырнадцать','пятнадцать','шестнадцать','семнадцать','восемнадцать','девятнадцать'),            array('-','-','двадцать','тридцать','сорок','пятьдесят','шестьдесят','семьдесят','восемьдесят','девяносто'),            array('-','сто','двести','триста','четыреста','пятьсот','шестьсот','семьсот','восемьсот','девятьсот'),            array('-','одна','две')        );# Все варианты написания разрядов прописью скомпануем в один небольшой массив        $r=array(            array('...ллион','','а','ов'), // используется для всех неизвестно больших разрядов            array('тысяч','а','и',''),            array('миллион','','а','ов'),            array('миллиард','','а','ов'),            array('триллион','','а','ов'),            array('квадриллион','','а','ов'),            array('квинтиллион','','а','ов')            // ,array(... список можно продолжить        );        if($num==0)return$m[0][0]; # Если число ноль, сразу сообщить об этом и выйти        $o=array(); # Сюда записываем все получаемые результаты преобразования# Разложим исходное число на несколько трехзначных чисел и каждое полученное такое число обработаем отдельно        foreach(array_reverse(str_split(str_pad($num,ceil(strlen($num)/3)*3,'0',STR_PAD_LEFT),3))as$k=>$p){            $o[$k]=array();# Алгоритм, преобразующий трехзначное число в строку прописью            foreach($n=str_split($p)as$kk=>$pp)                if(!$pp)continue;else                    switch($kk){                        case 0:$o[$k][]=$m[4][$pp];break;                        case 1:if($pp==1){$o[$k][]=$m[2][$n[2]];break 2;}else$o[$k][]=$m[3][$pp];break;                        case 2:if(($k==1)&&($pp<=2))$o[$k][]=$m[5][$pp];else$o[$k][]=$m[1][$pp];break;                    }$p*=1;if(!$r[$k])$r[$k]=reset($r);# Алгоритм, добавляющий разряд, учитывающий окончание руского языка            if($p&&$k)switch(true){                case preg_match("/^[1]$|^\d*[0,2-9][1]$/",$p):$o[$k][]=$r[$k][0].$r[$k][1];break;                case preg_match("/^[2-4]$|\d*[0,2-9][2-4]$/",$p):$o[$k][]=$r[$k][0].$r[$k][2];break;                default:$o[$k][]=$r[$k][0].$r[$k][3];break;            }$o[$k]=implode(' ',$o[$k]);        }        return implode(' ',array_reverse($o));    }    $test_level_type_name='';    if ($act->test_level_type_id==1) $test_level_type_name='о владении русским языком как иностранным';    if ($act->test_level_type_id==2) $test_level_type_name='о владении русским языком как иностранным,знании истории России и основ законодательстваРоссийской Федерации';    ?>    <div>&nbsp;</div>    <div align="center" style="text-align: center">        <span style="font-size:12.0pt;color:#333333;text-align:center;font-weight: bold">Сводный протокол на оформление дубликата сертификата <?=$test_level_type_name?></span></div>    <br>    <br>    <div align="center" style="text-align: justify;"><span style="font-size:12.0pt;color:#333333;text-align:justify">        Сводный протокол  на оформление дубликата сертификата <b><?=$test_level_type_name?></b> составлен в электронном виде            <?= $act->getUniversity()->getLegalInfo()['form'] . ' ' . $act->getUniversity()->getLegalInfo()['name_parent']; ?>            (далее – по тексту – «Организация») в лице <u><?= $director_local; ?></u>            в электронном виде и согласован            <?= TEXT_HEADCENTER_LONG_TP_PRINT_ACT_NEW ?> (<?= TEXT_HEADCENTER_SHORT_IP ?>) (далее по тексту «<?= TEXT_HEADCENTER_SHORT_IP ?>»)            в электронном виде в лице <u><?=$director_head;?></u> в соответствии с            Договором <br>№ <u><?= $dogovor_num; ?></u> от <u><?= strtolower($dogovor_date); ?>г.</u> (далее по тексту «Договор) о нижеследующем:</div>    <div align="center" style="text-align:center"><b>&nbsp;</b></div>    <div style="margin-left:18.0pt;text-align:justify;text-indent:-18.0pt;"><span style="font-size:12.0pt;color:#333333"><b>1.</b><span style="font:7.0pt &quot;Times New Roman&quot;">&nbsp;&nbsp;&nbsp;&nbsp; </span></span><span            style="font-size:12.0pt;color:#333333">        В соответствии с условиями  Договора <u><?= $dogovor_num; ?></u> от <u><?= strtolower($dogovor_date); ?>г.</u>            оформлен(ы) дубликат(ы) сертификата(ов) <?=$test_level_type_name?>:    </div>    <div>&nbsp;</div>    <table width="100%" cellspacing="0" cellpadding="0" border="1" class="main_td"           style="width:100.0%;border-collapse:collapse;border:none;">        <tbody>        <tr>            <td rowspan="<?= ($kolichestvo*3)+1;?>" style=" width: 10px;">1.</td>            <td style=" width: 10px;"></td><td>Ф.И.О.</td><td></td><td>Информация о сертификате</td><td>дата</td>        </tr>        <?        $i=1;        foreach (DublActManList::getByDublAct($act->id) as $man):?>            <tr><td rowspan="3"><?=$i++;?></td><td rowspan="3"><?=$man->getSurnameRus().' '.$man->getNameRus();?></td>                <td>Экзаменационная сессия</td><td><?=ActMan::getByID($man->old_man_id)->getAct()->id;?></td><td><?=date("d.m.Y",strtotime(ActMan::getByID($man->old_man_id)->getAct()->created));?></td></tr>            <tr><td>Информация о ранее выданном сертификате</td><td><?=ActMan::getByID($man->old_man_id)->blank_number;?></td><td><?=date("d.m.Y",strtotime(ActMan::getByID($man->old_man_id)->blank_date));?></td></tr>            <tr><td>Информация о вновь выданном сертификате</td><td><?=CertificateDuplicate::getByUserID($man->old_man_id)->certificate_number;?></td><td><?=date("d.m.Y",strtotime(CertificateDuplicate::getByUserID($man->old_man_id)->certificate_issue_date));?></td></tr>        <? endforeach; ?><tr><td colspan="6">&nbsp;</td></tr>        <tr>            <td rowspan="2">2.</td>            <td colspan="2">Общее количество человек</td>            <td>Стоимость услуг <?=TEXT_HEADCENTER_SHORT_IP?> в расчете за 1 человека (руб.), в т. ч. НДС <?=$nds->getNdsValue();?>%</td>            <td colspan="2">Общая стоимость услуг <?=TEXT_HEADCENTER_SHORT_IP?> за оформление дубликата сертификата (руб.), в т. ч. НДС <?=$nds->getNdsValue();?>%</td>        </tr>        <tr>            <td colspan="2"><?php echo $kolichestvo ?></td>            <td><?php echo $dubl_price ?></td>            <td colspan="2"><?php echo $kolichestvo*$dubl_price ?></td>        </tr>    </table>    <div style="text-align:justify"><i>&nbsp;</i></div>    <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333;">	<b>2.</b>    Стоимость услуг <?=TEXT_HEADCENTER_SHORT_IP?> по оформлению    дубликата(ов) сертификата(ов) <?=$test_level_type_name?> составляет	<u><?=$sum_total_rub; ?></u> руб. <u><?=$sum_total_kop; ?></u> коп. (<?=num_propis($sum_total_rub)?>),            включая НДС <?=$nds->getNdsValue();?>% в размере <u><?=$nds_total_rub; ?></u>  руб. <u><?=$nds_total_kop; ?></u> коп. <?/*=num_propis($nds_total_rub)*/?>    и подлежит перечислению в <?=TEXT_HEADCENTER_SHORT_IP?> на основании  счета № <u><?=$act->invoice_index;?>/<?=$act->invoice;?></u>    от <u><?=/*$invoice_date*/$invoice_date_simple;?></u>	</span>        <!--	</p>-->    </div>    <div style="text-align:justify"><i>&nbsp;</i></div>    <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333">	<b>3.</b> Претензии со стороны Организации по исполнению <?=TEXT_HEADCENTER_SHORT_IP?> своих обязательств в рамках Договора отсутствуют.	</span></div>    <div style="text-align:justify"><i>&nbsp;</i></div>    <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333"><b>4.</b>Настоящий протокол составил и достоверность данных подтвердил - <u><?=$director_local;?></u></span></div>    <div style="text-align:justify"><i>&nbsp;</i></div>    <div style="text-align:justify"><span style="font-size:12.0pt;color:#333333"><b>5.</b> Настоящий протокол согласован - <u><?=$director_head;?></u></span></div></div></body></html>